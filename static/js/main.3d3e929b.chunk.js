(this.webpackJsonpprototype=this.webpackJsonpprototype||[]).push([[0],{43:function(e,t,a){e.exports=a(58)},48:function(e,t,a){},58:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(16),r=a.n(s),o=(a(48),a(28)),l=a(6),h=a(7),c=a(17),u=a(11),d=a(12),m=a(2),g=a(29),p=a(36),v=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,[{key:"getTemperature",value:function(e,t,a){return 70}},{key:"getHumidity",value:function(e,t,a){return 70}},{key:"getLandscape",value:function(){return null}},{key:"getCameraStart",value:function(){return 5}},{key:"getViewpoints",value:function(){return[]}},{key:"getAgents",value:function(){return[]}}]),e}(),w=a(10),f=a(37),b=function(){function e(t,a,n,i,s,r,o,h){var c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;if(Object(l.a)(this,e),this.marked=!1,this.THREE=t,this.radio=a,this.id=n,this.size=s,this.world=i,this.x=r,this.y=o,this.z=h,this.rotx=c,this.roty=u,this.rotz=d,this.state={},this.createMesh(),this.neighbors=[],"undefined"===typeof n)throw new Error("Agent.id must be set");if("undefined"===typeof a)throw new Error("Agent.radio must be set")}return Object(h.a)(e,[{key:"setMarked",value:function(e){this.marked=e;for(var t=this.group.children.length-1;t>=0;t--)this.group.remove(this.group.children[t]);if(this.group.add(this.mesh),this.marked){var a=new this.THREE.SphereGeometry(1.3*this.size,24,24,0,2*Math.PI,0,Math.PI/2),n=new this.THREE.MeshBasicMaterial({color:16711680}),i=new this.THREE.Mesh(a,n);i.position.copy(new this.THREE.Vector3(this.x,this.y,this.z-this.size)),i.rotation.x=this.rotx,i.rotation.y=this.roty,i.rotation.z=this.rotz,this.group.add(i)}}},{key:"getMarked",value:function(){return this.marked}},{key:"getState",value:function(){return this.state}},{key:"getPosition",value:function(){return new this.THREE.Vector3(this.x,this.y,this.z)}},{key:"createMesh",value:function(){this.geometry=new this.THREE.SphereGeometry(this.size,24,24,0,2*Math.PI,0,Math.PI/2),this.material=new this.THREE.MeshBasicMaterial({color:16777215}),this.mesh=new this.THREE.Mesh(this.geometry,this.material),this.mesh.position.copy(new this.THREE.Vector3(this.x,this.y,this.z)),this.mesh.rotation.x=this.rotx,this.mesh.rotation.y=this.roty,this.mesh.rotation.z=this.rotz,this.group=new this.THREE.Group,this.group.add(this.mesh)}},{key:"getMesh",value:function(){return this.group}},{key:"loop",value:function(e){}},{key:"setNeighbors",value:function(e){this.neighbors=Object(f.a)(e)}},{key:"getNeighbors",value:function(){return this.neighbors}},{key:"addNeighbor",value:function(e){this.neighbors.push(e)}},{key:"removeNeighbor",value:function(e){var t=this.neighbors.indexOf(e);-1!==t&&this.neighbors.splice(t,1)}},{key:"receiveMessage",value:function(e){}}]),e}(),y=a(9),k=a(18),S=a(68),x=(a(49),a(50),a(51),a(52),a(53),a(54),a(55),a(56),a(57),a(27),"Idle"),C="ImAlive",E="ImDead",M="Resurrect",A=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e,n,i,s,r,o,h,c){var u,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,p=arguments.length>11?arguments[11]:void 0,v=arguments.length>12?arguments[12]:void 0;return Object(l.a)(this,a),(u=t.call(this,e,n,i,s,r,o,h,c,d,m,g)).debugSim=!1,u.debugNetwork=!1,u.lastStateSend=0,u.lastCycle=0,u.neighborState=new Map,u.params=p,u.setAlive(v),u.state.lastCycle=0,u.state.state=x,u.state.batch=0,u.state.aliveCount=0,u}return Object(h.a)(a,[{key:"setAlive",value:function(e){this.state.alive=e,e?this.material.color.setHex(16711935):this.material.color.setHex(2236962)}},{key:"isAlive",value:function(){return this.state.alive}},{key:"loop",value:function(e){var t=this;if(e>this.lastStateSend+this.params.stateSendTime){this.lastStateSend=e;var a={command:this.state.alive?C:E};this.debugSim&&0===this.id&&console.log("Sending state: "+this.state.alive+" to neighbors: "+this.neighbors.length);for(var n=0;n<this.neighbors.length;n++)this.radio.sendMessage(this.id,this.neighbors[n],a)}if(this.debugSim&&0===this.id&&console.log("Check cycle.  time: "+e+" next: "+(this.lastCycle+this.params.cycleTime)+" lastCycle: "+this.lastCycle+" cycleTime: "+this.params.cycleTime),e>this.lastCycle+this.params.cycleTime){this.debugSim&&0===this.id&&console.log("Cycle done.  Updating state.  neighbors: "+this.neighborState.size),this.lastCycle=e;var i=0;if(this.neighborState.forEach((function(e,a){t.debugSim&&0===t.id&&console.log(e,a),e&&i++})),this.debugSim&&0===this.id&&console.log("Agent: "+this.id+" aliveN: "+i),!0!==this.state.alive||2!==i&&3!==i)if(!1===this.state.alive){if(3===i)this.setAlive(!0);else if(Math.random()<this.params.spontaneousGeneration&&(this.setAlive(!0),Math.random()<this.params.resurrectionChance))for(var s=0;s<this.neighbors.length;s++){var r={command:M};this.radio.sendMessage(this.id,this.neighbors[s],r)}}else this.setAlive(!1);else this.setAlive(!0)}}},{key:"receiveMessage",value:function(e){switch(this.debugNetwork&&0===this.id&&console.log("Agent: "+this.id+" recv: "+JSON.stringify(e)),e.msg.command){case M:Math.random()<this.params.resurrectionChance&&this.setAlive(!0);break;case C:this.neighborState.set(e.from,!0);break;case E:this.neighborState.set(e.from,!1)}}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("h1",null,"Game of Life"))}}]),a}(b);function O(e){var t=Object(n.useState)(e.startPattern),a=Object(w.a)(t,2),s=a[0],r=a[1],o=Object(n.useState)(e.size),l=Object(w.a)(o,2),h=l[0],c=l[1],u=Object(n.useState)(e.cycleTime),d=Object(w.a)(u,2),m=d[0],g=d[1],p=Object(n.useState)(e.spontaneousGeneration),v=Object(w.a)(p,2),f=v[0],b=v[1],x=Object(n.useState)(e.resurrectionChance),C=Object(w.a)(x,2),E=C[0],M=C[1];return i.a.createElement("div",{style:{width:"512px",border:"1px solid black",padding:"8px"}},i.a.createElement("h1",null,"Game of Life - Agent Control"),i.a.createElement("form",{onSubmit:function(t){return t&&t.preventDefault(),e.paramsChangedAction({startPattern:s,size:h,cycleTime:m,spontaneousGeneration:f,resurrectionChance:E}),null}},i.a.createElement(S.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Start Pattern",options:["critical","toad","beacon","blinker","random","corners","blank","quadpole","pulsar","test"],value:s,onChange:function(e){return r(e.target.value)}}),i.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Size",required:!0,value:h,onChange:function(e){return c(parseInt(e.target.value))}}),i.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"CycleTime",required:!0,value:m,onChange:function(e){return g(parseInt(e.target.value))}}),i.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Spontaneous Generation",required:!0,value:f,onChange:function(e){return b(e.target.value)}}),i.a.createElement(k.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Resurrection Chance",required:!0,value:E,onChange:function(e){return M(e.target.value)}}),i.a.createElement(y.a,{style:{width:"100%"},type:"submit",label:"Update"})))}a(34);var P=Object(n.memo)((function(e){return i.a.createElement("div",{style:{border:"1px solid black",padding:"8px"}},i.a.createElement("h1",null,"Simulation Control"),i.a.createElement("div",{style:{width:"100px",margin:"auto"}},i.a.createElement("b",null,"time: ",e.time)),i.a.createElement(y.a,{label:"Play",onClick:e.playAction}),i.a.createElement(y.a,{label:"Pause",onClick:e.pauseAction}),i.a.createElement(y.a,{label:"Step",onClick:e.stepAction}),i.a.createElement(y.a,{label:"Reset",onClick:e.resetAction}))}));var z=Object(n.memo)((function(e){var t=Object(n.useState)(""),a=Object(w.a)(t,2),s=a[0],r=a[1],o=Object(n.useState)([]),l=Object(w.a)(o,2),h=l[0],c=l[1],u=Object(n.useState)("Orbit"),d=Object(w.a)(u,2),m=d[0];return d[1],Object(n.useEffect)((function(){for(var t=[],a=0;a<e.viewpoints.length;a++)t.push(e.viewpoints[a].name);r(t[0]),c(t)}),[e.viewpoints]),i.a.createElement("div",{style:{border:"1px solid black",padding:"8px"}},i.a.createElement("h1",null,"Camera Control"),i.a.createElement("form",{onSubmit:function(t){t&&t.preventDefault();for(var a=0;a<e.viewpoints.length;a++)console.log(e.viewpoints[a]),e.viewpoints[a].name===s&&e.changeViewpointAction(e.viewpoints[a]);return e.changeNavModeAction(m),null}},i.a.createElement(S.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Viewpoint",options:h,value:s,onChange:function(e){return r(e.target.value)}}),i.a.createElement(y.a,{style:{width:"50%"},type:"submit",label:"Update"}),i.a.createElement(y.a,{style:{width:"50%"},label:"Reset",onClick:e.resetAction})))}));var T=Object(n.memo)((function(e){var t=Object(n.useState)(e.layout),a=Object(w.a)(t,2),s=a[0],r=a[1];return i.a.createElement("div",{style:{width:"512px",border:"1px solid black",padding:"8px"}},i.a.createElement("h1",null,"World Control"),i.a.createElement("form",{onSubmit:function(t){return t&&t.preventDefault(),e.paramsChangedAction({layout:s}),null}},i.a.createElement(S.a,{style:{width:"100%",height:"56px",margin:"auto",display:"block",marginTop:"24px"},label:"Layout",options:["grid","critical","forest"],value:s,onChange:function(e){return r(e.target.value)}}),i.a.createElement(y.a,{style:{width:"100%"},type:"submit",label:"Update"})))})),j=function(){function e(){Object(l.a)(this,e)}return Object(h.a)(e,null,[{key:"createRiver",value:function(e,t,a,n){for(var i=new e.Geometry,s=0;s<t.length;s++)i.vertices.push(new e.Vector3(a*t[s][0],a*n,a*t[s][1]));for(var r=0;r<t.length/2;r++)i.faces.push(new e.Face3(2*r,2*r+1,2*r+2)),i.faces.push(new e.Face3(2*r+1,2*r+3,2*r+2));var o=new e.MeshBasicMaterial({color:30654,side:e.DoubleSide,opacity:.5,transparent:!0});return new e.Mesh(i,o)}},{key:"createLand",value:function(e,t,a,n,i,s,r,o,l,h){var c=new e.Geometry;c.vertices.push(new e.Vector3(o*a,l*a,h*a));for(var u=n;u<=i;u+=s)c.vertices.push(new e.Vector3(a*t[u][0],0,a*t[u][1]));for(var d=(i-n)/s,m=0;m<d;m++)c.faces.push(new e.Face3(0,m+2,m+1));var g=new e.MeshBasicMaterial({color:9498256,side:e.DoubleSide});return new e.Mesh(c,g)}},{key:"createLandDebug",value:function(t,a,n,i,s,r,o,l,h,c){var u=[];u.push(new t.Vector3(l*n,h*n,c*n));for(var d=i;d<=s;d+=r)u.push(new t.Vector3(n*a[d][0],0,n*a[d][1]));u.push(new t.Vector3(l*n,h*n,c*n)),console.log("verts: "+u.length);var m=(new t.BufferGeometry).setFromPoints(u),g=new t.LineBasicMaterial({color:65280}),p=new t.PointsMaterial({size:1,color:16711680}),v=new t.Line(m,g),w=new t.Points(m,p),f=new t.Group;f.add(v),f.add(w),f.add(e.createLand(t,a,n,i,s,r,o,l,h,c));for(var b=0;b<u.length;b++){var y=e.makeLabelCanvas(128,64,b),k=new t.CanvasTexture(y);k.minFilter=t.LinearFilter,k.wrapS=t.ClampToEdgeWrapping,k.wrapT=t.ClampToEdgeWrapping;var S=new t.SpriteMaterial({map:k,transparent:!0}),x=new t.Sprite(S);x.position.x=u[b].x,x.position.y=(o+.01)*n,x.position.z=u[b].z;x.scale.x=1.06,x.scale.y=.512,f.add(x)}return f}},{key:"createRiverDebug",value:function(t,a,n,i){for(var s=[],r=0;r<a.length;r++)s.push(new t.Vector3(n*a[r][0],n*i,n*a[r][1]));var o=(new t.BufferGeometry).setFromPoints(s),l=new t.LineBasicMaterial({color:65280}),h=new t.PointsMaterial({size:1,color:16711680}),c=new t.Line(o,l),u=new t.Points(o,h),d=new t.Group;d.add(c),d.add(u),d.add(e.createRiver(t,a,n,i));for(var m=0;m<a.length;m++){var g=e.makeLabelCanvas(128,64,m),p=new t.CanvasTexture(g);p.minFilter=t.LinearFilter,p.wrapS=t.ClampToEdgeWrapping,p.wrapT=t.ClampToEdgeWrapping;var v=new t.SpriteMaterial({map:p,transparent:!0}),w=new t.Sprite(v);w.position.x=n*a[m][0],w.position.y=(i+.01)*n,w.position.z=n*a[m][1];w.scale.x=1.06,w.scale.y=.512,d.add(w)}return d}},{key:"createBox",value:function(e,t){var a=new e.Geometry;a.vertices.push(new e.Vector3(-1,-1,1),new e.Vector3(1,-1,1),new e.Vector3(-1,1,1),new e.Vector3(1,1,1),new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1),new e.Vector3(-1,1,-1),new e.Vector3(1,1,-1)),a.faces.push(new e.Face3(0,3,2),new e.Face3(0,1,3),new e.Face3(1,7,3),new e.Face3(1,5,7),new e.Face3(5,6,7),new e.Face3(5,4,6),new e.Face3(4,2,6),new e.Face3(4,0,2),new e.Face3(2,7,6),new e.Face3(2,3,7),new e.Face3(4,1,0),new e.Face3(4,5,1));var n=new e.MeshBasicMaterial({color:16777215,side:e.DoubleSide});return new e.Mesh(a,n)}},{key:"makeLabelCanvas",value:function(e,t,a){var n=document.createElement("canvas").getContext("2d"),i="".concat(t,"px bold sans-serif");n.font=i;var s=n.measureText(a).width,r=e+4,o=t+4;n.canvas.width=r,n.canvas.height=o,n.font=i,n.textBaseline="middle",n.textAlign="center",n.fillStyle="blue",n.fillRect(0,0,r,o);var l=Math.min(1,e/s);return n.translate(r/2,o/2),n.scale(l,1),n.fillStyle="white",n.fillText(a,0,0),n.canvas}}]),e}(),N=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).scale=76,e.points=[[.75,3.5],[1,3.5],[.75,3.25],[1,3.25],[.95,2.85],[1.25,3],[1.25,2.6],[1.75,2.6],[1.5,2.25],[1.85,2.25],[1.75,2],[2,2],[2,1.75],[2.25,1.75],[2.25,1.5],[2.4,1.6],[2.6,1.1],[2.9,1],[2.75,.75],[3,.75],[3,.5],[3.25,.75],[3.25,.3],[3.5,.75],[3.5,.25],[3.75,.75],[3.75,.25],[4,.75],[4.5,.75],[4.5,1],[4.75,.75],[4.75,1.25],[4.75,1.25]],e}return Object(h.a)(a,[{key:"getCameraStart",value:function(){return 50}},{key:"getLandscape",value:function(e){for(var t=this.points,a=this.scale,n=0;n<t.length;n++)t[n]=[t[n][0],t[n][1]];var i=new e.Group;return i.add(j.createRiver(e,t,a,-1/a)),i.add(j.createLand(e,t,a,1,t.length-2,2,0/a,3.5,0,5)),i.add(j.createLand(e,t,a,0,20,2,0/a,-5,0,-7)),i.add(j.createLand(e,t,a,20,30,2,0/a,5,0,-7)),i}},{key:"getAgents",value:function(e,t,a,n){for(var i=this.points,s=this.scale,r=0,o=[],l=7;l<14;l++){var h=i[l],c=i[l+1],u=new e.Vector3;u.subVectors(new e.Vector3(c[0],0,c[1]),new e.Vector3(h[0],0,h[1])),u.normalize(),u.multiplyScalar(.25),o.push(new A(e,n,r++,this,.4,h[0]*s+u.x*s,-.8,h[1]*s+u.z*s,0,0,0,a,Math.random()<.4)),u.multiplyScalar(.5),o.push(new A(e,n,r++,this,.4,h[0]*s+u.x*s,-.8,h[1]*s+u.z*s,0,0,0,a,Math.random()<.4)),u.multiplyScalar(.75),o.push(new A(e,n,r++,this,.4,h[0]*s+u.x*s,-.8,h[1]*s+u.z*s,0,0,0,a,Math.random()<.4))}for(var d=7;d<13;d++){var m=i[d],g=i[d+2],p=new e.Vector3,v=new e.Vector3,w=0;w=d%2===0?-Math.PI/2:Math.PI/2,p.subVectors(new e.Vector3(i[d+1][0],0,i[d+1][1]),new e.Vector3(m[0],0,m[1])),p.normalize(),console.log("shore: "+p.x+" "+p.y+" "+p.z),v.subVectors(new e.Vector3(g[0],0,g[1]),new e.Vector3(m[0],0,m[1])),v.normalize(),p.multiplyScalar(-.05),console.log("water.  pos: "+(m[0]*s+p.x*s)+" "+-.8+" "+(m[1]*s+p.z*s)),o.push(new A(e,n,r++,this,.2,m[0]*s+p.x*s,0,m[1]*s+p.y*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+p.x*s,1,m[1]*s+p.y*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+p.x*s,2,m[1]*s+p.y*s,0,0,w,a,Math.random()<.4)),v.multiplyScalar(.25),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,0,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,1,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,2,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),v.multiplyScalar(.5),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,0,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,1,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,2,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),v.multiplyScalar(.75),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,0,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,1,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4)),o.push(new A(e,n,r++,this,.2,m[0]*s+v.x*s+p.x*s,2,m[1]*s+v.z*s+p.z*s,0,0,w,a,Math.random()<.4))}return o}},{key:"getViewpoints",value:function(){var e=this.scale,t=[];return t.push({name:"Grid",position:[0,0,15]}),t.push({name:"Pot Luck Camp",position:[1.75*e,15/e,2.6*e],lookat:[1.5*e,2/e,2.25*e]}),t.push({name:"Far",position:[70,2,300]}),t.push({name:"Float End",position:[70,2,280]}),t}}]),a}(v),V=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this)).size=e,n}return Object(h.a)(a,[{key:"getCameraStart",value:function(){return this.size}},{key:"getLandscape",value:function(e){return new e.Group}}]),a}(v),L={height:512,maxWidth:1060},F=0,R=new m.Clock,D=function(e){Object(d.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).state={},e.debugNetwork=!1,e.debugNeighbors=!1,e.showNeighborsFor=-1,e.messages=[],e.simPaused=!0,e.pauseTime=Number.MAX_SAFE_INTEGER,e.time=0,e.viewpoints=[],e.lastLoopTime=(new Date).getTime(),e.world=null,e.navMode="Orbit",e.agentParams={startPattern:"pulsar",size:10,cycleTime:400,stateSendTime:50,spontaneousGeneration:.01,resurrectionChance:.5},e.worldParams={layout:"grid"},e.agentSetup=function(t){var a,n=0,i=!1,s=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];if("critical"===t.startPattern)return console.log("Critical agents"),void(e.agents=e.world.getAgents(m,"critical",t,Object(c.a)(e)));if("random"===t.startPattern)i=!0;else switch(t.startPattern){case"quadpole":a=[[0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0],[0,1,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,1,0,0],[0,0,0,0,0,0,1,1,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"blank":a=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"test":a=s;break;case"corners":a=[[1,1,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,1,1]];break;case"toad":a=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0],[0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"beacon":a=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"blinker":a=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]];break;case"pulsar":a=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];break;default:console.log("Unknown pattern"),a=s}var r=t.size;!i&&r<a.length&&(r=a.length),e.agents=[];for(var o=0;o<r;o++)for(var l=0;l<r;l++){var h=!0,u=l,d=o;i?h=Math.random()<.4:(u=l,d=r-o-1,h=1===a[o][l]);var g=new A(m,Object(c.a)(e),n++,e.world,.1,u-r/2,d-r/2,0,Math.PI/2,0,0,t,h);e.agents[o*r+l]=g}},e.sceneSetup=function(){var t=e.el.clientWidth,a=e.el.clientHeight;switch(e.scene=new m.Scene,e.camera=new m.PerspectiveCamera(75,t/a,.1,1e3),e.camera.position.z=10,e.navMode){case"Orbit":e.controls=new g.b(e.camera,e.el),e.controls.panSpeed=.2,e.controls.rotateSpeed=.2,e.controls.zoomSpeed=.02;break;case"Fly":e.controls=new p.a(e.camera,e.el);break;case"Map":e.controls=new g.a(e.camera,e.el),e.controls.enableDamping=!0,e.controls.dampingFactor=.05,e.controls.screenSpacePanning=!1,e.controls.minDistance=50,e.controls.maxDistance=700,e.controls.maxPolarAngle=Math.PI/2;default:console.log("Unknown controls")}e.renderer=new m.WebGLRenderer({antialias:!0}),e.renderer.setSize(t,a),e.el.appendChild(e.renderer.domElement)},e.addCustomSceneObjects=function(){for(var t=0;t<e.agents.length;t++)e.scene.add(e.agents[t].getMesh());e.scene.add(e.world.getLandscape(m)),e.camera.position.z=e.world.getCameraStart(),e.viewpoints=e.world.getViewpoints(),e.calcAgentNeighbors(8);var a=[];a[0]=new m.PointLight(16777215,1,0),a[1]=new m.PointLight(16777215,1,0),a[2]=new m.PointLight(16777215,1,0),a[0].position.set(0,200,0),a[1].position.set(100,200,100),a[2].position.set(-100,-200,-100)},e.startAnimationLoop=function(){e.requestID=window.requestAnimationFrame(e.startAnimationLoop);var t=(new Date).getTime();if(!e.simPaused){e.time+=t-e.lastLoopTime,e.setState({time:e.time,viewpoints:e.viewpoints});for(var a=[],n=0;n<e.messages.length;n++)e.messages[n].time<e.time&&(e.debugNetwork&&console.log("Routing message: "+JSON.stringify(e.messages[n])),"undefined"===typeof e.messages[n].to?console.log("Invalid message: "+JSON.stringify(e.messages[n])):e.agents[e.messages[n].to].receiveMessage(e.messages[n]),a.push(n));for(var i=0;i<a.length;i++)e.messages.splice(a[i]-i,1);for(var s=0;s<e.agents.length;s++)e.agents[s].loop(e.time);if(e.time>e.pauseTime)return e.simPaused=!0,e.renderer.render(e.scene,e.camera),void(e.pauseTime=Number.MAX_SAFE_INTEGER)}e.lastLoopTime=t,(F+=R.getDelta())<1/33||(e.controls.update(),e.renderer.render(e.scene,e.camera),F%=1/33)},e.handleWindowResize=function(){var t=e.el.clientWidth,a=e.el.clientHeight;e.renderer.setSize(t,a),e.camera.aspect=t/a,e.camera.updateProjectionMatrix()},e}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.sceneSetup(),this.worldSetup(),this.agentSetup(this.agentParams),this.addCustomSceneObjects(),this.startAnimationLoop(),window.addEventListener("resize",this.handleWindowResize),this.setState({time:0,viewpoints:this.viewpoints}),"undefined"!==typeof this.viewpoints[0]&&this.handleChangeViewpoint(this.viewpoints[0]),this.renderer.render(this.scene,this.camera)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize),window.cancelAnimationFrame(this.requestID),this.controls.dispose()}},{key:"worldSetup",value:function(){switch(this.worldParams.layout){case"grid":this.world=new V(this.agentParams.size);break;case"critical":this.world=new N}}},{key:"calcAgentNeighbors",value:function(e){this.debugNeighbors&&console.log("Calculating neighbors");for(var t=0;t<this.agents.length;t++){this.debugNeighbors&&console.log("Agent: "+t);for(var a=[],n=this.agents[t].getPosition(),i=0;i<this.agents.length;i++)if(i!==t){var s=this.agents[i].getPosition().distanceToSquared(n);a.push({dist:s,agentIdx:i})}a.sort((function(e,t){return e.dist-t.dist})),this.debugNeighbors&&console.log(JSON.stringify(a));for(var r=[],o=Math.min(e,a.length),l=0;l<o;l++)r[l]=a[l].agentIdx;this.debugNeighbors&&console.log(JSON.stringify(r)),this.agents[t].setNeighbors(r)}if(-1!==this.showNeighborsFor)for(var h=this.agents[this.showNeighborsFor].getNeighbors(),c=0;c<h.length;c++)this.agents[h[c]].setMarked(!0)}},{key:"sleep",value:function(e){var t=Date.now(),a=null;do{a=Date.now()}while(a-t<e)}},{key:"sendMessage",value:function(e,t,a){if(this.debugNetwork&&console.log("Send message. from: "+e+" to: "+t+" msg: "+JSON.stringify(a)),"undefined"===typeof e)throw new Error("From is required");if("undefined"===typeof t)throw new Error("To is required");this.messages.push({from:e,to:t,msg:a,time:this.time+0*Math.random()})}},{key:"handleSimPause",value:function(){this.simPaused=!0}},{key:"handleSimPlay",value:function(){this.simPaused=!1,this.lastLoopTime=(new Date).getTime()}},{key:"handleSimStep",value:function(){this.simPaused=!1,this.lastLoopTime=(new Date).getTime(),this.pauseTime=this.time+this.agentParams.cycleTime}},{key:"handleSimReset",value:function(){for(this.simPaused=!0,this.time=0,this.setState({time:this.time,viewpoints:this.viewpoints}),this.lastLoopTime=(new Date).getTime(),this.messages=[];this.scene.children.length>0;)this.scene.remove(this.scene.children[0]);this.worldSetup(),this.agentSetup(this.agentParams),this.addCustomSceneObjects(),"undefined"!==typeof this.viewpoints[0]&&this.handleChangeViewpoint(this.viewpoints[0])}},{key:"handleCameraReset",value:function(){this.controls.reset()}},{key:"handleAgentParamsChanged",value:function(e){console.log("Params changed: "+JSON.stringify(e)),this.agentParams=Object(o.a)({},this.agentParams,{},e),this.handleSimReset()}},{key:"handleWorldParamsChanged",value:function(e){console.log("World Params changed: "+JSON.stringify(e)),this.worldParams=Object(o.a)({},this.worldParams,{},e),this.handleSimReset()}},{key:"markNeighbors",value:function(e){for(var t=0;t<this.agents.length;t++)this.agents[t].setMarked(!1);for(var a=this.agents[e].getNeighbors(),n=0;n<a.length;n++)this.agents[a[n]].setMarked(!this.agents[a[n]].getMarked())}},{key:"showAliveCount",value:function(e){console.log("Agent: "+e);for(var t=this.agents[e].getNeighbors(),a=0,n=0;n<t.length;n++)console.log("neighbor: "+t[n]+" alive: "+this.agents[t[n]].isAlive()),this.agents[t[n]].isAlive()&&a++;console.log("aliveCount: "+a)}},{key:"handleKeyPressed",value:function(e){switch(e.key){case"0":this.markNeighbors(90),this.showAliveCount(90);break;case"1":this.markNeighbors(91),this.showAliveCount(91);break;case"2":this.markNeighbors(92),this.showAliveCount(92);break;case"3":this.markNeighbors(93),this.showAliveCount(93);break;case"4":this.markNeighbors(94),this.showAliveCount(94);break;case"5":this.markNeighbors(95),this.showAliveCount(95);break;case"6":this.markNeighbors(96),this.showAliveCount(96);break;case"7":this.markNeighbors(97),this.showAliveCount(97);break;case"8":this.markNeighbors(98),this.showAliveCount(98);break;case"9":this.markNeighbors(99),this.showAliveCount(99);break;case"s":this.handleSimStep();break;case"c":for(var t=0;t<this.agents.length;t++)this.agents[t].setMarked(!1)}}},{key:"handleChangeViewpoint",value:function(e){console.log("new vp: "+e.position+" lookat: "+e.lookat),this.camera.position.x=e.position[0],this.camera.position.y=e.position[1],this.camera.position.z=e.position[2],"undefined"!==typeof e.lookat&&this.camera.lookAt(e.lookat[0],e.lookat[1],e.lookat[2])}},{key:"handleChangeNavMode",value:function(e){}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",{style:L,ref:function(t){return e.el=t},onKeyPress:function(t){return e.handleKeyPressed(t)},autoFocus:!0}),i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("div",null,i.a.createElement(P,{time:this.state.time,resetAction:function(t){return e.handleSimReset()},pauseAction:function(t){return e.handleSimPause()},playAction:function(t){return e.handleSimPlay()},stepAction:function(t){return e.handleSimStep()}}),i.a.createElement(z,{viewpoints:this.viewpoints,changeNavModeAction:function(t){return e.handleChangeNavMode(t)},resetAction:function(t){return e.handleCameraReset()},changeViewpointAction:function(t){return e.handleChangeViewpoint(t)}}),i.a.createElement(T,Object.assign({},this.worldParams,{paramsChangedAction:function(t,a){return e.handleWorldParamsChanged(t,a)}}))),i.a.createElement(O,Object.assign({},this.agentParams,{paramsChangedAction:function(t,a){return e.handleAgentParamsChanged(t,a)}}))))}}]),a}(n.Component),G=Object(n.memo)(D);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(G,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[43,1,2]]]);
//# sourceMappingURL=main.3d3e929b.chunk.js.map